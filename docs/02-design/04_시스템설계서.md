# 시스템 설계서

## 1. 문서 목적
본 문서는 동네책장 플랫폼의 실제 코드 구조를 기준으로 시스템 구성과 데이터 흐름을 정리한다.

## 2. 기술 스택
* **Frontend**: React + Next.js (App Router)
* **UI**: Tailwind CSS
* **상태 관리**: Zustand (sessionStorage 또는 localStorage persist)
* **서버 통신**: Fetch + Next Server Actions
* **캐시/갱신**: `fetch` 캐시 태그 + `revalidateTag`, `revalidatePath`

## 3. 시스템 아키텍처
* App Router 기반으로 서버/클라이언트 컴포넌트를 혼합 구성
* 책 목록/상세, 모임 게시글/댓글은 서버에서 조회하고 캐시 태그로 관리
* 생성/수정/삭제는 Server Action에서 API 호출 후 갱신
* 인증 상태는 Zustand로 관리하고 로그인 유지 선택 시 localStorage, 미선택 시 sessionStorage에 저장

## 4. 주요 구성 요소
* **라우팅**: 로그인/회원가입, 책 목록/상세/등록/수정, 채팅 목록/채팅방, 모임 게시판 목록/상세/작성, 찜 목록, 프로필, 후기, 알림
* **상태 관리**: 사용자 인증 정보, UI 상태, 찜 목록, 채팅방 목록 및 읽지 않은 메시지 상태
* **데이터 처리**: 책/모임 게시글/댓글 조회와 CRUD 처리,
채팅방 및 메시지 데이터 조회·전송 처리 (책(상품) 게시글 기준 1:1 채팅방 생성 방식)

## 5. 데이터 흐름
1. 서버 컴포넌트에서 목록/상세 데이터 조회
2. 폼 제출 시 Server Action에서 API 호출
3. 성공 시 캐시 갱신 후 페이지 이동
4. 로그인 성공 시 클라이언트에서 사용자 정보 저장

## 6. 환경 변수/연동
* `NEXT_PUBLIC_API_URL`, `NEXT_PUBLIC_CLIENT_ID` 사용
* 모든 API 요청에 `Client-Id` 헤더 포함
* 인증 API는 `Authorization: Bearer <token>` 사용

## 7. 보안 및 정책
* 인증 필요 기능은 로그인 사용자만 접근
* 작성/수정/삭제는 작성자만 가능 (서버 검증 기준)
* 토큰은 로그인 유지 선택 시 localStorage, 미선택 시 sessionStorage에 저장